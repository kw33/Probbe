
SIZE_START; начальный размер блока памяти
SIZE_END_X2; до какого размера удваивать
SIZE_BLOCK = SIZE_END_X2; далее прибавлять этот
                        ; размер
HeapSize
HeapBegin

---------------------------------
объект: размер окр. до 2^BITGRAN

len in bytes, word
data


...
------------------------------------
; KW Replaceable / Resizeable Heap
=-----------------------------------
Изменяемая однопоточная куча:
----------------
Структура KWRHEAPINFO
  Битовое поле
  Данные
  Таблица адресов данных (стэк)
----------------
Клиент запрашивает память из кучи,
получает адрес указателя.
Работает через этот указатель. 
Если гарантировано отсутствие вызовов
функций кучи:
HeapPut 
HeapDel 
HeapDefrag, и др.
то можно пользвать адрес взятый из указателя
ранее и не считывать его заново.
Для данных, в DataBottom сохраняется
адрес незанятого пространства для стэка
с таблицей адресов.
Стэк заполняется до DataBottom, затем
надо сделать HeapDefrag, и если DataBottom
не уменьшилось, увеличить размер кучи.
При удалении объекта из кучи также обнуляется 
адрес в таблице, кот. можно использовать для
следующего объекта.
ОДНАКО
Таблицу адресов перемещать нельзя, поэтому она 
должна лежать в отдельном участке памяти, или быть
стэковой, но после увеличения кучи и перемещения 
её в др. место, можно использовать старую память
кучи для стэковой таблицы! При этом делаем
HeapBottom = HeapBegin и не меняем более.
Тут нужен флаг IsHeapReplaced.
Таблица имеет переменные:
HeapTableBottom 
HeapTableTop 


------------------------------------
; таблица адресов и размеров блоков
; поиск свободного блока
------------------------------------
Жуть
Задаться:
текущий адрес TecAddr равен началу данных
Просканировать таблицу и найти ближайший
больший адрес NextAddr
Если меж ними влазит нужный блок - гут
Иначе TecAddr = NextAddr + BlockSize
Вернуться к сканированию

--------------------#--------------------
Куча в виде двунаправленного списка

dword PrevAddr
dword NextAddr
Data...


------------------------------------
; хранение переменных Бэйсика
------------------------------------
VarTableAddr - где находится таблица
переменных.
Сама таблица:
VarTable[] - адреса данных для переменных 
VARIABLE - структура данных для переменной:
  Тип (размер данных)
  Данные 
  Длина имени
  Имя
Таблицу Addr[] сортировать по алфавиту 
Возможно завершающим элементом должен 
быть NULL или -1
    ; получить адрес данных пер-ной номер X
    mov eax,[VarTableAddr]
    mov eax,[eax + X*4]
    ; в eax адрес структуры VARIABLE
    
